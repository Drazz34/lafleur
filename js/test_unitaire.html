<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test unitaire</title>
</head>

<body>

    <section class="livraison formulaire">
        
        <label for="livraison_cp"></label>
        <select name="livraison_cp" id="livraison_cp" class="input_form" onchange="updateVilleSelect()"
            data-villes-cp1='["Ville1", "Ville2"]' data-villes-cp2='["Ville3", "Ville4"]'
            data-codes-postaux='["10000", "20000"]' required>
            <option value="">-- Code postal --</option>
            <option value="10000">10000</option>
            <option value="20000">20000</option>
        </select>
        <label for="livraison_ville"></label>
        <select name="livraison_ville" id="livraison_ville" class="input_form" required>
            <option value="">-- Ville --</option>
        </select>
        
    </section>

    <script>
        function updateVilleSelect() {
            const cpSelect = document.getElementById('livraison_cp');
            const villeSelect = document.getElementById('livraison_ville');
            const villesCp1 = JSON.parse(cpSelect.dataset.villesCp1);
            const villesCp2 = JSON.parse(cpSelect.dataset.villesCp2);
            const codesPostaux = JSON.parse(cpSelect.dataset.codesPostaux);
            const cp = cpSelect.value;

            villeSelect.innerHTML = '<option value="">-- Ville --</option>';

            if (cp === codesPostaux[0]) {
                for (let ville of villesCp1) {
                    villeSelect.innerHTML += `<option value="${ville}">${ville}</option>`;
                }
            } else if (cp === codesPostaux[1]) {
                for (let ville of villesCp2) {
                    villeSelect.innerHTML += `<option value="${ville}">${ville}</option>`;
                }
            }
        }

        function assert(condition, message) {
            if (!condition) {
                throw new Error(message || "Test échoué");
            }
        }

        function testUpdateVilleSelect() {
            // Remplacez ces valeurs par les valeurs réelles que vous souhaitez tester
            const villesCp1 = ["Montpellier", "Castelnau"];
            const villesCp2 = ["Restinclières", "Castries"];
            const codesPostaux = ["34000", "34160"];

            const testDom = `
        <section class="livraison formulaire">
            <!-- ... (autres éléments du formulaire) -->
            <select name="livraison_cp" id="livraison_cp" class="input_form" onchange="updateVilleSelect()" data-villes-cp1='${JSON.stringify(villesCp1)}' data-villes-cp2='${JSON.stringify(villesCp2)}' data-codes-postaux='${JSON.stringify(codesPostaux)}' required>
                <option value="">-- Code postal --</option>
                ${codesPostaux.map(cp => `<option value="${cp}">${cp}</option>`).join('')}
            </select>
            <label for="livraison_ville"></label>
            <select name="livraison_ville" id="livraison_ville" class="input_form" required>
                <option value="">-- Ville --</option>
            </select>
            <!-- ... (autres éléments du formulaire) -->
        </section>
    `;
            document.body.innerHTML = testDom;

            
            const cpSelect = document.getElementById('livraison_cp');
            const villeSelect = document.getElementById('livraison_ville');

            cpSelect.value = "34000";
            updateVilleSelect();
            assert(villeSelect.innerHTML.includes('<option value="Montpellier">Montpellier</option>'), "Montpellier doit être présente pour le code postal 34000");
            assert(villeSelect.innerHTML.includes('<option value="Castelnau">Castelnau</option>'), "Castelnau doit être présente pour le code postal 34000");
            assert(!villeSelect.innerHTML.includes('<option value="Marseille">Marseille</option>'), "Marseille ne doit pas être présente pour le code postal 34000");

            cpSelect.value = "34160";
            updateVilleSelect();
            assert(!villeSelect.innerHTML.includes('<option value="Paris">Paris</option>'), "Paris ne doit pas être présente pour le code postal 34160");
            assert(villeSelect.innerHTML.includes('<option value="Restinclières">Restinclières</option>'), "Restinclières doit être présente pour le code postal 34160");

            cpSelect.value = "";
            updateVilleSelect();
            assert(villeSelect.innerHTML === '<option value="">-- Ville --</option>', "La liste des villes doit être réinitialisée si aucun code postal n'est sélectionné");
        }

        try {
            testUpdateVilleSelect();
            console.log("Tous les tests ont réussi");
        } catch (error) {
            console.error("Échec du test :", error.message);
        }

    </script>
</body>

</html>